<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:a4j="http://richfaces.org/a4j" xmlns:interkont="http://www.interkont.com/jsf"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:rich="http://richfaces.org/rich"
                xmlns:ui="http://java.sun.com/jsf/facelets">

    <f:view locale="#{var.rcalendarlocale}" id="prueba_p">

        <ui:composition template="/facelets/template_main.xhtml">

            <ui:define name="menu">
                <ui:include src="/facelets/menu_gestion.xhtml"/>
            </ui:define>
            <ui:define name="menu_lateral">
                <h:panelGroup  rendered="#{!var.permisonuevodiseno}">
                    <ui:include src="/facelets/menu_lateral_gestion.xhtml"/>
                </h:panelGroup>
                <h:panelGroup rendered="#{var.permisonuevodiseno}">
                    <ui:include src="/facelets/menu_lateral_novedades_zoom.xhtml"/>
                </h:panelGroup>
            </ui:define>

            <ui:define name="title">
                <h:outputText  styleClass="ikont-hot-administrar"   value="Ingresar Usuario"></h:outputText>
            </ui:define>
            <div id="header_content" >
                <div class="star">
                    <h:outputText  styleClass="ikont-hot-ingreentidad"   value="Ingresar Usuario" />
                </div>
            </div>
            <ui:define name="body">
                <h:form>
                    <rich:panel id="panelingresarusuario">
                        <a4j:region id="form_">
                            <h:panelGrid  columns="2" styleClass="ikont-panel-registro">
                                <h:selectBooleanCheckbox title="#{var.enviar} #{var.Correo}" value="#{Ciudadano$PerfilCiudadano.habilitarEnvioCorreo}"/>
                                <h:outputLabel value="Desea enviarle correo electrónico de bienvenida al usuario creado?"/>
                            </h:panelGrid>
                            <h:panelGrid id="ingresarciudadanonuevo" columns="2" styleClass="ikont-panel-registro" >

                                <h:inputText required="true" maxlength="250" id="textnombre" value="#{SessionBeanCobra.ciudadanoservice.ciudadano.tercero.strnombre}" styleClass="ikont-hit-textnombre"  >
                                    <rich:placeholder value="Nombre" />
                                </h:inputText>
                                <h:inputSecret required="true" id="textpassword" size="25" value="#{SessionBeanCobra.ciudadanoservice.password}" styleClass="ikont-hit-textpassword"  >
                                    <rich:placeholder value="Contraseña" />
                                </h:inputSecret>
                                <h:inputText required="true"  id="textusuario" maxlength="25" value="#{SessionBeanCobra.ciudadanoservice.ciudadano.usuLogin}" styleClass="ikont-hittextusuario"  >
                                    <rich:placeholder value="Usuario" />
                                </h:inputText>

                                <h:inputSecret  required="true" id="textrepassword" size="25" value="#{SessionBeanCobra.ciudadanoservice.repassword}" styleClass="ikont-hit-textrepassword"  >
                                    <rich:placeholder value="Confirmar Contraseña" />
                                </h:inputSecret>

                                <h:inputText required="true" maxlength="80" id="textcorreo"  value="#{SessionBeanCobra.ciudadanoservice.ciudadano.tercero.stremail}" styleClass="ikont-hit-textcorreo" >
                                    <rich:placeholder value="Em@il" />
                                </h:inputText>
                                <h:selectOneMenu id="combodepartamentoCiudadanuevo"  value="2"  >
                                    <f:selectItems value="#{Perfil$Usuario.localidadusuario}" />
                                    <a4j:ajax event="change" execute="@this"
                                              render="combocargargrupos"/>
                                </h:selectOneMenu> 

                                <h:outputLabel styleClass="ikont-outtext-subtitulo"  value="#{var.fechadeNacimiento}" />
                                <rich:calendar  id="fechaciudadanonuevo" locale="#{var.rcalendarlocale}" datePattern="#{var.formatofecha}"  styleClass="inputText_registro"  
                                                value="#{SessionBeanCobra.ciudadanoservice.ciudadano.tercero.datefechanacimiento}"/>

                                <h:outputLabel  styleClass="ikont-outtext-subtitulo"  value="#{var.generoContratista}"/>
                                <h:selectOneMenu  id="combogeneronuevo" value="genero">
                                    <f:selectItems value="#{Perfil$Usuario.generosoption}" />
                                </h:selectOneMenu>

                            </h:panelGrid>
                            <rich:collapsiblePanel header="#{var.configurarusuario}"  id="configurarusuario" style="width: 1000px" >
                                <h:panelGrid   cellspacing="10" id="ikont-panel-selects-conusu">
                                    <h:panelGrid columns="2">
                                        <h:outputLabel styleClass="ikont-outtext-subtitulo"  value="#{var.grupo}"/>
                                        <h:selectOneMenu id="combocargargrupos" value="#{Ciudadano$PerfilCiudadano.intidgrupo}" style="position: relative;left: 184px;">
                                            <f:selectItems value="#{Perfil$Usuario.gruposoption}" />
                                            <a4j:ajax event="valueChange" execute="combocargarModulos,selectmodulo" listener="#{Ciudadano$PerfilCiudadano.llenarModulos}"
                                                      render="combocargarModulos,configurarusuario,ikont-panel-localidad,ikont-panel-tipoUsuario,ikont-panel-entidad"/>
                                        </h:selectOneMenu>
                                    </h:panelGrid>
                                    <h:panelGrid columns="2" id="selectmodulo" rendered="#{Ciudadano$PerfilCiudadano.habilitartablalistarusuario}">
                                        <h:outputLabel styleClass="ikont-outtext-subtitulo"  value="#{var.seleccionmodulo}" />
                                        <h:selectOneMenu id="combocargarModulos" value="#{Ciudadano$PerfilCiudadano.intidmodulo}" style="position: relative;left: 110px;">
                                            <f:selectItems value="#{Ciudadano$PerfilCiudadano.modulosoption}" />
                                            <a4j:ajax execute="idconfiguracionusuario" event="valueChange" render="idconfiguracionusuario"  />
                                        </h:selectOneMenu>
                                        <h:panelGrid>
                                            <a4j:commandButton   value="#{var.adicionar}" id="agregar_modgru"  execute="configurarusuario,idconfiguracionusuario" render="configurarusuario"  actionListener="#{Ciudadano$PerfilCiudadano.listarGrupoModulo}" />
                                        </h:panelGrid>
                                    </h:panelGrid>
                                </h:panelGrid>

                                <rich:dataTable rendered="#{Ciudadano$PerfilCiudadano.listausuGrupos.size()>0}" id="idconfiguracionusuario"
                                                rows="10"  
                                                value="#{Ciudadano$PerfilCiudadano.listausuGrupos}"
                                                var="registro" rowKeyVar="filaSeleccionada"
                                                binding="#{Ciudadano$PerfilCiudadano.tablagrupomodulo}"
                                                style="width: 36%!important;"
                                                >
                                    <rich:column>
                                        <f:facet name="header">
                                            <h:outputText   value="#{var.grupo}" />
                                        </f:facet>
                                        <h:outputText value="#{registro.grupo.gruNombre}"/>
                                    </rich:column>
                                    <rich:column>
                                        <f:facet name="header">
                                            <h:outputText value="#{var.modulo}" />
                                        </f:facet>
                                        <h:outputText  styleClass="ikont-hot-numpoliza" id="otxt-strnumPolizaContrato" value="#{registro.modulo.strmodNmbre}"/>
                                    </rich:column>
                                    <rich:column>
                                        <f:facet name="header">
                                            <h:outputText   value="#{var.eliminar}" />
                                        </f:facet>
                                        <a4j:commandLink execute="idconfiguracionusuario,configurarusuario" render="idconfiguracionusuario,configurarusuario,ikont-panel-localidad,ikont-panel-tipoUsuario,ikont-panel-entidad" value="#{var.eliminar}" action="#{Ciudadano$PerfilCiudadano.eliminarGrupoModulo}"/>
                                    </rich:column>
                                </rich:dataTable>
                                <h:panelGrid  rendered="false">
                                    <h:selectOneRadio id="radiotipousuario" value="#{Ciudadano$PerfilCiudadano.tipoasociacion}">
                                         <f:selectItem  itemValue="1" itemLabel="Asociación de Proyectos"/>   
                                         <f:selectItem itemValue="2" itemLabel="Asociación de  Convenios"/>   
                                         <a4j:ajax  render="ikont-panel-relacionobrajsfusuario,relacionproyectousua,relacioncontratousuario" execute="ikont-panel-relacionobrajsfusuario,relacionproyectousua,relacioncontratousuario"/>
                                    </h:selectOneRadio>
                                </h:panelGrid>
                            </rich:collapsiblePanel>


                            <h:panelGroup id="ikont-panel-tipoUsuario" >
                                <h:selectOneMenu id="combocargartipousuario" value="#{Ciudadano$PerfilCiudadano.intidtipousuario}" rendered="false  " style="position: relative;left: 225px;top: 4px;">
                                    <f:selectItems value="#{Perfil$Usuario.tipousuariooption}" />
                                    <a4j:ajax event="valueChange" execute="@this" render="ikont-panel-localidad,ikont-panel-tipoUsuario,ikont-panel-entidad" listener="#{Supervisor$IngresarNuevaObra.ingresaraModalLocalidad}" />
                                </h:selectOneMenu>
                                <br/>
                                <br/>
                                <br/>
                                <h:panelGroup id="ikont-panel-localidad"  rendered="#{Ciudadano$PerfilCiudadano.intidtipousuario==2}">
                                    <rich:collapsiblePanel header="Seleccione la localidad"   expanded="true" switchType="ajax">
                                        <h:outputLabel  styleClass="ikont-outtext-subtitulo"   id="lblclasificacionProyecto"  value="Tipo origen" for="comboclasificacionproyecto" style="position: relative;left: -270px;top: -5px;"/>
                                        <h:selectOneMenu id="comboclasificacionproyecto" value="#{Ciudadano$PerfilCiudadano.intorigen}" disabled="#{Supervisor$IngresarNuevaObra.tipoOrigenSoloLectura}" style="top: 29px;position: relative;left: 145px;">  
                                            <f:selectItem itemLabel="Nacional" itemValue="1" />
                                            <f:selectItem itemLabel="Departamental" itemValue="2" />
                                            <a4j:ajax event="valueChange" execute="@this,combodepartamentoproyecto"  render="panelLocalidadProyecto,combodepartamentoproyecto" listener="#{Supervisor$IngresarNuevaObra.ingresaraModalLocalidad}" />
                                        </h:selectOneMenu>

                                        <h:panelGroup layout="block" id="panelLocalidadProyecto"  >
                                            <h:panelGroup    layout="block" rendered="#{var.habilitarLocalidadesEjecutaraPoryecto}" >
                                                <h:panelGroup id="paneldeptomuniproyecto" rendered="#{Ciudadano$PerfilCiudadano.intorigen!=1}">
                                                    <h:panelGroup id="gpdeptomuniproyecto" rendered="#{Ciudadano$PerfilCiudadano.intorigen ==2}">
                                                        <h:panelGrid cellspacing="5" cellpadding="5" columns="2" style="position: relative;left: -2px;top: 23px;">
                                                            <h:selectOneMenu id="combodepartamentoproyecto" disabled="#{var.habilitarDepartamentoEjecutaraProyecto}" value="#{Ciudadano$PerfilCiudadano.codDepartamento}" style="position: relative;top: 11px;left: 213px;">
                                                                <f:selectItems value="#{Supervisor$IngresarNuevaObra.departamento}" />
                                                                <a4j:ajax execute="@this, combodepartamentoproyecto,pgasociarObrasUsuario" event="valueChange" listener="#{Supervisor$IngresarNuevaObra.llenarMunicipio}"
                                                                          render="panelmunipioproyecto,pgasociarObrasUsuario" />
                                                            </h:selectOneMenu>
                                                        </h:panelGrid>
                                                    </h:panelGroup>
                                                </h:panelGroup>
                                            </h:panelGroup>
                                        </h:panelGroup>
                                    </rich:collapsiblePanel>
                                </h:panelGroup>

                                <h:panelGroup id="ikont-panel-entidad" >
                                    <h:form>
                                        <rich:collapsiblePanel rendered="#{Ciudadano$PerfilCiudadano.intidgrupo ==16 || Ciudadano$PerfilCiudadano.intidgrupo ==19  || Ciudadano$PerfilCiudadano.intidgrupo ==20}" header="#{var.asociar} #{var.entidad}"    switchType="ajax" id="asociarentidad">

                                            <h:panelGrid style="width: 100%;" id="panelcontenidoentidad" columns="3">
                                                <h:panelGroup>
                                                    <h:panelGrid columns="2">
                                                        <h:outputLabel value="#{var.buscar} #{var.entidad}"/>
                                                        <interkont:spacer/>
                                                        <h:inputText id="inputtextEntidad"  value="#{Perfil$Usuario.strbuscarentidad}"  onfocus="clearText(this);"
                                                                     />
                                                        <a4j:commandButton  execute="@this,inputtextEntidad,idbuscarentidad,tableasociarentidad"   render="@ll,idbuscarentidad,asociarentidad,panelcontenidoentidad" 
                                                                            actionListener="#{Perfil$Usuario.buscarEntidad}" value="#{var.Buscar}"/>
                                                    </h:panelGrid>
                                                    <rich:dataTable rendered="#{Perfil$Usuario.strnoencontrabusqueda}" style="border-collapse: inherit!important;"  binding="#{Perfil$Usuario.datatablelistaentidades}"
                                                                    rows="8" var="varentidad"  value="#{Perfil$Usuario.listaentidades}" id="tableasociarentidad">
                                                        <rich:column>
                                                            <f:facet name="header">
                                                                <h:outputLabel value="#{var.seleccionar}"/>
                                                            </f:facet>
                                                            <h:selectBooleanCheckbox value="#{Perfil$Usuario.listaentidadbooleana[varentidad]}"
                                                                                     immediate="true" valueChangeListener="#{Perfil$Usuario.seleccionarUnaEntidad}">
                                                                <f:ajax event="click" render="@form"/>

                                                            </h:selectBooleanCheckbox>
                                                        </rich:column>

                                                        <rich:column>
                                                            <f:facet name="header">
                                                                <h:outputText value="#{var.codigo} #{var.entidad}"/>
                                                            </f:facet>
                                                            <h:outputText value="#{varentidad.intcedula}"/>
                                                        </rich:column>
                                                        <rich:column>
                                                            <f:facet name="header">
                                                                <h:outputText value="#{var.nombreentidad}"/>
                                                            </f:facet>
                                                            <h:outputText value="#{varentidad.strnombrecompleto}"/>
                                                        </rich:column>
                                                    </rich:dataTable>
                                                    <h:panelGroup rendered="#{!Perfil$Usuario.strnoencontrabusqueda}">
                                                        <h:outputText value="#{var.noseencontrolaentidad}"/>
                                                    </h:panelGroup>
                                                    <rich:dataScroller rendered="#{Perfil$Usuario.listaentidades.size()>10}" for="tableasociarentidad" maxPages="5" />
                                                </h:panelGroup>
                                                <rich:column>
                                                    <center>
                                                        <a4j:commandButton rendered="#{Perfil$Usuario.listaentidadbooleana.size()>0}" immediate="true" execute="repeatentidadseleciconadas" render="repeatentidadseleciconadas,asociarentidad" actionListener="#{Perfil$Usuario.listarEntidadesSeleccionadas}" value="#{var.listar} #{var.entidad} #{var.seleccion}"/>
                                                        <br/>
                                                        <br/>
                                                        <a4j:commandButton rendered="#{Perfil$Usuario.inhabilitarseleccionentidades and Perfil$Usuario.listaentidad.size()>0}" immediate="true" execute="repeatentidadseleciconadas" render="repeatentidadseleciconadas,asociarentidad" actionListener="#{Perfil$Usuario.limpiarSeleccionEntidad}" value="#{var.cancelar}"/>
                                                    </center>
                                                </rich:column>
                                                <h:panelGrid id="idbuscarentidad">
                                                    <h:panelGroup rendered="#{Perfil$Usuario.inhabilitarseleccionentidades and Perfil$Usuario.listaentidad.size()>0}">
                                                        <rich:dataTable rendered="#{Perfil$Usuario.inhabilitarseleccionentidades}" style="border-collapse: inherit!important;width:422px;bottom: -49px;position: relative;"
                                                                        rows="5" var="varentidad"  value="#{Perfil$Usuario.listaentidad}" id="repeatentidadseleciconadas">
                                                            <rich:column>
                                                                <h:selectBooleanCheckbox value="#{Perfil$Usuario.listaentidadbooleana[varentidad]}"
                                                                                         immediate="true" valueChangeListener="#{Perfil$Usuario.seleccionarUnaEntidad}">
                                                                    <f:ajax event="click" render="@form"/>
                                                                </h:selectBooleanCheckbox>
                                                            </rich:column>
                                                            <rich:column>
                                                                <f:facet name="header">
                                                                    <h:outputText value="#{var.nombreentidad}"/>
                                                                </f:facet>
                                                                <h:outputText value="#{varentidad.strnombrecompleto}"/>
                                                            </rich:column>
                                                        </rich:dataTable>
                                                        <rich:dataScroller rendered="#{Perfil$Usuario.listaentidad.size()> 4}" for="repeatentidadseleciconadas" maxPages="5" />
                                                    </h:panelGroup>
                                                </h:panelGrid>
                                            </h:panelGrid>

                                        </rich:collapsiblePanel>
                                        <h:panelGroup id="ikont-panel-relacionobrajsfusuario" rendered="#{Ciudadano$PerfilCiudadano.intidgrupo ==20 || Ciudadano$PerfilCiudadano.intidgrupo ==23 || Ciudadano$PerfilCiudadano.intidgrupo ==18}">

                                            <rich:collapsiblePanel id="relacionproyectousua"  header="#{var.asociar} Obra Jsf Usuario"    switchType="ajax">
                                                <ui:include src="/Administrador/asociarporjsfusuario.xhtml" />
                                            </rich:collapsiblePanel>

                                            <rich:collapsiblePanel id="relacioncontratousuario" rendered="false" header="#{var.asociar} Convenio Usuario"    switchType="ajax">
                                                <ui:include src="/Administrador/asociarContratoUsuario.xhtml" />
                                            </rich:collapsiblePanel>

                                        </h:panelGroup>

                                    </h:form> 
                                </h:panelGroup>

                            </h:panelGroup>                     
                            <center>
                                <h:panelGrid columns="2">
                                    <a4j:commandButton id="btnGuardarCiudadano"  
                                                       value="#{var.guardar}"  
                                                       action="#{Ciudadano$PerfilCiudadano.MostrarMensajeNuevoUsuario}" render="pgguardarCiudadano"  execute="@form"
                                                       oncomplete="#{rich:component('confirmarCiudadano')}.show();"
                                                       >
                                    </a4j:commandButton> 
                                    <h:commandButton id="btnCancelarRegistroEntidad" value="#{var.cancelar}"  action="#{Ciudadano$PerfilCiudadano.saliringresarUsuario}" immediate="true" 
                                                     />
                                </h:panelGrid>
                            </center>
                        </a4j:region>
                    </rich:panel>
                </h:form>


            </ui:define>
        </ui:composition>
    </f:view>
</ui:composition>