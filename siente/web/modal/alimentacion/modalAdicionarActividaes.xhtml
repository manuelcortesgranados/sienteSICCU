<?xml version='1.0' encoding='UTF-8' ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition  xmlns="http://www.w3.org/1999/xhtml"
                 xmlns:a4j="http://richfaces.org/a4j" 
                 xmlns:interkont="http://www.interkont.com/jsf"
                 xmlns:f="http://java.sun.com/jsf/core"
                 xmlns:h="http://java.sun.com/jsf/html"
                 xmlns:rich="http://richfaces.org/rich"
                 xmlns:ui="http://java.sun.com/jsf/facelets">


    <rich:popupPanel id="modalAdicioarActividades" width="500" autosized="true" headerClass="rich-panel-header">
        <f:facet name="header" >
            <h:panelGroup >
                <h:outputText value="Adición de actividades/ítems no previstos"/>
            </h:panelGroup>
        </f:facet>

        <f:facet name="controls">
            <h:form>
                <h:panelGroup>
                    <a4j:commandLink id="esconder_modalAdicioarActividades" styleClass="cerrar" 
                                     title="#{var.cerrar}" immediate="true" onclick="#{rich:component('modalAdicioarActividades')}.hide();
                                             return false;"/>
                </h:panelGroup>
            </h:form>
        </f:facet>

        <rich:panel id="panelAdicionarActividades" style="width:100%; overflow-y: scroll; height:500px;">
            <center>
                <h:form>
                    <rich:panel styleClass="rich-panel-grid-activimodal"
                                bodyClass="rich-panel-grid-body-activimodal" headerClass="font-header-panel">
                        <center>
                            <h:panelGrid id="objetoactividad" columns="3" columnClasses="panelderecha, panelizquierda, panelizquierda">
                                <h:outputText value="Actividad / ítem no previsto:"/>
                                <interkont:spacer width="20" />
                                <h:inputTextarea cols="30" rows="2" value="#{Supervisor$Alimentar.actividadobra.strdescactividad}"/>

                                <h:outputText value="#{var.unidaddemedida}:"/>
                                <interkont:spacer width="20" />
                                <h:inputText alt="Metros / M"
                                             size="20"
                                             maxlength="10"
                                             value="#{Supervisor$Alimentar.actividadobra.strtipounidadmed}"/>

                                <h:outputText value="#{var.valorunitaio}:"/>
                                <interkont:spacer width="20" />
                                <h:panelGrid columns="1">
                                    <h:inputText onfocus="clearText(this);" required="true"
                                                 id="numHabitantes" value="#{Supervisor$Alimentar.actividadobra.calcularValorUnitario}">
                                        <f:convertNumber  maxFractionDigits="2" minFractionDigits="2" type="number" />
                                        <f:validateDoubleRange minimum="0"/>
                                    </h:inputText>
                                    <rich:message for="numHabitantes" styleClass="error_texto"/>
                                </h:panelGrid>
                            </h:panelGrid>
                        </center>
                    </rich:panel>
                    <a4j:commandButton value="#{var.adicionar} #{var.actividad}"
                                       action="#{Supervisor$Alimentar.agregaractividad}" render="objetoactividad">
                        <a4j:ajax event="complete" 
                                  render="tablaitemprevistos, objetoactividad, validarguardar"/>
                    </a4j:commandButton>

                    <rich:dataTable
                        onrowmouseout="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'"
                        onrowmouseover="this.style.backgroundColor='#B4DDEC'"
                        id="tablaitemprevistos"
                        sortMode="single"
                        rows="2"
                        value="#{Supervisor$Alimentar.listactividadobra}"
                        var="itemsprevis"
                        binding="#{Supervisor$Alimentar.tablaitemnoprevistos}"
                        style="width: 96%" >

                        <f:facet name="header">
                            <rich:columnGroup>
                                <rich:column colspan="5">
                                    <h:outputText value="#{var.actividades} Adicionadas"/>
                                </rich:column>
                                <rich:column breakRowBefore="true">
                                    <h:outputText value="Actividad / ítem no previsto"/>
                                </rich:column>
                                <rich:column>
                                    <h:outputText value="#{var.unidaddemedida}"/>
                                </rich:column>
                                <rich:column>
                                    <h:outputText value="#{var.valorunitaio}"/>
                                </rich:column>
                                <rich:column rendered="#{!Supervisor$AdministrarObraNew.obra.aplicaaiu}">
                                    <h:outputText value="#{var.valortotal}"/>
                                </rich:column>
                                <rich:column>
                                    <h:outputText value="#{var.eliminar}"/>
                                </rich:column>
                            </rich:columnGroup>
                        </f:facet>
                        <rich:columnGroup>
                            <rich:column>
                                <h:outputText value="#{itemsprevis.strdescactividad}"/>
                            </rich:column>
                            <rich:column>
                                <h:outputText value="#{itemsprevis.strtipounidadmed}"/>
                            </rich:column>
                            <rich:column>
                                <h:outputText value="#{itemsprevis.calcularValorUnitario}">
                                    <f:convertNumber pattern="$#,###.00"/>
                                </h:outputText>
                            </rich:column>
                            <rich:column rendered="#{!Supervisor$AdministrarObraNew.obra.aplicaaiu}">
                                <h:outputText value="#{itemsprevis.numvalorplanifao}">
                                    <f:convertNumber pattern="$#,###.00"/>
                                </h:outputText>
                            </rich:column>
                            <rich:column>
                                <a4j:commandButton value="#{var.eliminar}" action="#{Supervisor$Alimentar.eliminaractividad}"
                                                   render="tablaitemprevistos"/>
                            </rich:column>
                        </rich:columnGroup>
                        <f:facet name="footer">
                            <rich:columnGroup>
                                <rich:column colspan="5" breakRowBefore="true" style="text-align: center;">
                                    <rich:dataScroller for="tablaitemprevistos" render="tablaitemprevistos"/>
                                </rich:column>
                            </rich:columnGroup>
                        </f:facet>
                    </rich:dataTable>

                    <interkont:spacer height="20" />

                    <rich:panel id="reportatentodos" header="#{var.definaelcostototal}" styleClass="rich-panel-grid-activimodal"
                                bodyClass="rich-panel-grid-body-activimodal" headerClass="font-header-panel">
                        <center>
                            <h:panelGrid columns="2" columnClasses="inputsDetalle,inputsDetalle,inputsDetalle">
                                <h:outputText value="El valor unitario de las actividades incluye el AIU?"/>
                                <h:selectOneMenu value="#{Supervisor$AdministrarObraNew.obra.aplicaaiu}" >
                                    <f:selectItem itemValue="false" itemLabel="No"/>
                                    <f:selectItem itemValue="true" itemLabel="Si"/>
                                    <a4j:ajax event="onchange" render="gpPanelTipoCostos"/>
                                </h:selectOneMenu>

                                <h:outputLabel value="#{var.tipocosto}"/>
                                <h:selectOneMenu value="#{Supervisor$AdministrarObraNew.obra.tipocosto.inttipocosto}" disabled="true">
                                    <f:selectItems value="#{Supervisor$Alimentar.tipoCostoOption}" />
                                </h:selectOneMenu>
                            </h:panelGrid>

                            <h:panelGroup id="gpPanelTipoCostos">
                                <h:panelGrid columns="3" columnClasses="panelderecha, panelizquierda, panelizquierda" rendered="#{!Supervisor$AdministrarObraNew.obra.aplicaaiu}">

                                    <h:outputLabel value="#{var.costodirecto}"/>
                                    <interkont:spacer width="20" />
                                    <h:panelGroup>
                                        <h:outputText styleClass="txt_informacion_encabezado" value="#{Supervisor$AdministrarObraNew.obra.numvaltotobra}">
                                            <f:convertNumber pattern="$#,###.00"/>
                                        </h:outputText>
                                    </h:panelGroup>

                                    <h:outputLabel value="#{var.administracion} (%):" />
                                    <interkont:spacer width="20" />
                                    <h:outputText value="#{Supervisor$AdministrarObraNew.obra.floatporadmon}%"/>

                                    <h:outputLabel value="#{var.imprevistos} (%):" rendered="#{Supervisor$AdministrarObraNew.obra.tipocosto.inttipocosto==1}"/>
                                    <interkont:spacer width="20" />
                                    <h:outputText value="#{Supervisor$AdministrarObraNew.obra.floatporimprevi}%" rendered="#{Supervisor$AdministrarObraNew.obra.tipocosto.inttipocosto==1}"/>

                                    <h:outputLabel value="Utilidad (%):" rendered="#{Supervisor$AdministrarObraNew.obra.tipocosto.inttipocosto==1}"/>
                                    <interkont:spacer width="20" />
                                    <h:outputText value="#{Supervisor$AdministrarObraNew.obra.floatporutilidad}%" rendered="#{Supervisor$AdministrarObraNew.obra.tipocosto.inttipocosto==1}"/>

                                    <h:outputLabel value="#{var.ivasobreutilidad} (%):" rendered="#{Supervisor$AdministrarObraNew.obra.tipocosto.inttipocosto==1}"/>
                                    <h:outputLabel value="#{var.ivasobreadministracion} (%):" rendered="#{Supervisor$AdministrarObraNew.obra.tipocosto.inttipocosto!=1}"/>
                                    <interkont:spacer width="20" />
                                    <h:outputText value="#{Supervisor$AdministrarObraNew.obra.floatporivasobreutil}%"/>

                                    <h:outputLabel value="#{var.otros} (%):" />
                                    <interkont:spacer width="20" />
                                    <h:outputText value="#{Supervisor$AdministrarObraNew.obra.floatporotros}%"/>

                                    <h:outputLabel value="#{var.costototal}:"/>
                                    <interkont:spacer width="20" />
                                    <h:outputText styleClass="txt_informacion_encabezado"
                                                  value="#{Supervisor$AdministrarObraNew.obra.numvaltotobra}">
                                        <f:convertNumber pattern="$ ###,###,###"/>
                                    </h:outputText>
                                </h:panelGrid>
                            </h:panelGroup>
                        </center>
                    </rich:panel>
                    <interkont:spacer height="20" />                    

                    <h:panelGrid id="layoutActasDetalle" columns="1" style="text-align:center;" width="98%">
                        <a4j:commandButton value="Añadir Acta de Convenio de Precios" render="faltarender"
                                           onclick="#{rich:component('modalActaPrecios')}.show();"
                                           style="font-size:12px;"/>
                        <h:inputText id="pathacta" disabled="true" size="50" value="#{Supervisor$Alimentar.pathActaPrecios}" />
                    </h:panelGrid>

                    <h:panelGrid id="validarguardar">
                        <a4j:commandButton rendered="#{Supervisor$Alimentar.validarGuardarItemNoPrevis}"
                                           value="#{var.guardar}" action="#{Supervisor$Alimentar.guardarActividades}" >
                            <a4j:ajax event="oncomplete"  render="layoutTablaMatrix,scroll" oncomplete="#{rich:component('modalAdicioarActividades')}.hide() "/>
                        </a4j:commandButton>
                    </h:panelGrid>
                </h:form>
            </center>
        </rich:panel>

    </rich:popupPanel>

</ui:composition>