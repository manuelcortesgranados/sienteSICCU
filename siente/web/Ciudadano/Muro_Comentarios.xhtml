<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a4j="http://richfaces.org/a4j" 
    xmlns:interkont="http://www.interkont.com/jsf"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions"
    xmlns:m="http://code.google.com/p/gmaps4jsf/">

    <f:subview id="Comentarios" rendered="#{SessionBeanCobra.usuarioObra.renderrecurso.btnmuro_comentarios}">
        <h:form>
            <a4j:poll id="pollComentarios" rendered="#{SessionBeanCobra.actualcomentario}"
                      action="#{SessionBeanCobra.LlenarComentarios}" render="pgcomentario" interval="500000" >
                <a4j:status id="statuspollComentarios"/>
            </a4j:poll>
        </h:form>

        <h:form id="formComentarios">
            <script language="JavaScript">
                function maximaLongitud(texto, maxlong) {
                    var out_value;

                    if (texto.value.length > maxlong) {
                        in_value = texto.value;
                        out_value = in_value.substring(0, maxlong);
                        texto.value = out_value;
                        return false;
                    }

                    return true;
                }

                function borrar_campo1() {
                    if (document.getElementById("murocomentarios:Comentarios:formComentarios:iacomentario").value == "Escriba Su Comentario") {
                        document.getElementById("murocomentarios:Comentarios:formComentarios:iacomentario").value = "";
                    }
                }
            </script>

            <h:panelGroup layout="block" id="panelcomentarios">
                <div id="header_content">
                    <div class="comentario">
                        <h:outputText value="Muro de Comentarios" styleClass="ikont-hot-murodecomentarios" />
                    </div>
                </div> 

                <interkont:spacer height="10"/>
                <h:panelGrid columns="1" >
                    <a4j:region id="idregion">
                        <h:panelGrid  cellspacing="10" id="txtcomentario1" columns="1"  styleClass="totalwidth">
                            <a4j:status id="idstatuscomentario" />

                            <h:outputText id="idcontarmensaje" value="#{Ciudadano$PerfilCiudadano.contarmensaje}"
                                          styleClass="ikont-hot-idcontarmensaje vtitle12" />

                            <h:inputTextarea id="iacomentario" rows="5" cols="120"
                                             value="#{SessionBeanCobra.ciudadanoservice.opinionciudadano.stropinion}"
                                             onfocus="borrar_campo1(this);" onkeydown="return maximaLongitud(this, 400);"
                                             styleClass="ikont-hit-iacomentario commentframe">
                                <a4j:ajax event="keyup" listener="#{Ciudadano$PerfilCiudadano.contarcomentario}" render="idcontarmensaje" status="idstatuscomentario" />
                            </h:inputTextarea>

                            <h:outputText value="Utilice este espacio para opinar e intercambiar opiniones con los demÃ¡s ciudadanos"
                                          styleClass="ikont-hot-espacioparaopinar vtitle09" />                      
                        </h:panelGrid>
                    </a4j:region>

                    <a4j:commandLink action="#{Ciudadano$PerfilCiudadano.AgregarComentarioGeneral}"
                                     render="pgcomentario, panelcomentarios" styleClass="ikont-acl-agregarcomentario publicar" />

                    <h:panelGrid columns="2" id="pgcomentario"  styleClass="totalwidth">
                        <a4j:repeat id="rpcomentario" value="#{SessionBeanCobra.ciudadanoservice.listaComentarios}"
                                    binding="#{Ciudadano$PerfilCiudadano.repeatusuario}" var="rowcomentario" rows="3" >
                            <h:panelGrid columns="2"  styleClass="totalwidth" columnClasses=",totalwidth">
                                <h:panelGrid styleClass="ikont-hpg-cargarusuario commentframe">
                                    <a4j:commandLink action="#{Ciudadano$PerfilCiudadano.cargarUsuario}" type="submit" >
                                        <h:graphicImage url="#{rowcomentario.jsfUsuario.tercero.strfoto}"
                                                        styleClass="ikont-hgi-strfoto picborder"/>
                                    </a4j:commandLink>

                                    <interkont:spacer width="30" />
                                </h:panelGrid>

                                <h:panelGrid columns="2" styleClass="totalwidth tablesinspace" columnClasses="ikont-hgi-td-com_arrow">
                                    <h:graphicImage  styleClass="ikont-hgi-com_arrow " url="/resources/imgs/com_arrow.png" />

                                    <h:panelGrid styleClass="ikont-hpg-comentarios commentuser totalwidth">
                                        <h:panelGroup styleClass="">
                                            <h:outputText id="idstrnombre" value="#{rowcomentario.jsfUsuario.tercero.strnombrecompleto}"
                                                          styleClass="ikont-hot-idstrnombre vtitle03" />

                                            <interkont:spacer />
                                            <h:outputText id="iddate" value="#{rowcomentario.datefechaopinion}"
                                                          styleClass="ikont-hot-iddate vtitle09">
                                                <f:convertDateTime timeZone="GMT-5" type="both" dateStyle="long" />
                                            </h:outputText>
                                        </h:panelGroup>

                                        <h:panelGrid>
                                            <h:outputLabel id="idcomentario" value="#{rowcomentario.stropinion}"
                                                           styleClass="ikont-hot-idcomentario " />
                                        </h:panelGrid>
                                    </h:panelGrid>
                                </h:panelGrid>
                            </h:panelGrid>
                        </a4j:repeat>
                    </h:panelGrid>
                </h:panelGrid>
            </h:panelGroup>
        </h:form>
    </f:subview>
</ui:composition>