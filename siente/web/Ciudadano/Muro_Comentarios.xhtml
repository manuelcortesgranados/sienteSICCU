<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a4j="http://richfaces.org/a4j" 
    xmlns:interkont="http://www.interkont.com/jsf"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions"
    xmlns:m="http://code.google.com/p/gmaps4jsf/"  
    >

    <f:subview id="Comentarios" rendered="#{SessionBeanCobra.usuarioObra.renderrecurso.btnmuro_comentarios}" >
     
            <h:form>
                <a4j:poll  id = "refreshId"  rendered="#{SessionBeanCobra.actualcomentario}"
                           action="#{SessionBeanCobra.LlenarComentarios}"  render = "panelcomentarios" interval = "1000" >

                </a4j:poll>
            </h:form>
        
        <h:form id="formComentarios">
            <script language="JavaScript">

                function maximaLongitud(texto, maxlong)
                {
                    var out_value;

                    if (texto.value.length > maxlong)
                    {
                        in_value = texto.value;
                        out_value = in_value.substring(0, maxlong);
                        texto.value = out_value;
                        return false;
                    }
                    return true;
                }
                function borrar_campo1(){
                    if (document.getElementById("murocomentarios:Comentarios:formComentarios:iacomentario").value == "Escriba Su Comentario") {
                        document.getElementById("murocomentarios:Comentarios:formComentarios:iacomentario").value = "";
                    }

                }

            </script>
            <rich:panel id="panelcomentarios" >
                <div id="header_content">
                    <div stylestyleClasscomentario">
                        <h:outputText  stylestyleClassikont-hot-murodecomentarios"   value="Muro de Comentarios"/>
                    </div>
                </div> 
                <interkont:spacer height="10"/>
                <h:panelGrid columns="1" >
                    <a4j:region id="idregion">
                        <h:panelGrid  id="txtcomentario1" columns="1"  >
                            <a4j:status id="idstatuscomentario"/>
                            <h:outputText  stylestyleClassikont-hot-idcontarmensaje"   id="idcontarmensaje" value="#{Ciudadano$PerfilCiudadano.contarmensaje}" />
                            <h:inputTextarea id="iacomentario" stylestyleClassikont-hit-iacomentario"   rows="5" cols="120" onkeydown="return maximaLongitud(this, 400)"     
                                             value="#{SessionBeanCobra.ciudadanoservice.opinionciudadano.stropinion}" onfocus="borrar_campo1(this);">
                                <a4j:ajax listener="#{Ciudadano$PerfilCiudadano.contarcomentario}" event="keyup" render="idcontarmensaje" status="idstatuscomentario" />
                            </h:inputTextarea>
                            <h:outputText  stylestyleClassikont-hot-espacioparaopinar"   value="Utilice este espacio para opinar e intercambiar opiniones con los demÃ¡s ciudadanos" />                      
                        </h:panelGrid>
                    </a4j:region>
                    <a4j:commandLink stylestyleClassikont-acl-agregarcomentario"   action="#{Ciudadano$PerfilCiudadano.AgregarComentarioGeneral}" render="pgcomentario,panelcomentarios">
                    </a4j:commandLink>
                    <h:panelGrid columns="2" id="pgcomentario" >
                        <a4j:repeat id="rpcomentario" value="#{SessionBeanCobra.ciudadanoservice.listaComentarios}"  binding="#{Ciudadano$PerfilCiudadano.repeatusuario}" var="rowcomentario" rows="3" >
                            <h:panelGrid columns="3"  >

                                <h:panelGrid stylestyleClassikont-hpg-cargarusuario"  >
                                    <a4j:commandLink action="#{Ciudadano$PerfilCiudadano.cargarUsuario}" type="submit" >
                                        <h:graphicImage  stylestyleClassikont-hgi-strfoto"   url="#{var.ipserver}siente#{rowcomentario.jsfUsuario.tercero.strfoto}"  />
                                    </a4j:commandLink>
                                    <interkont:spacer width="30"/>
                                </h:panelGrid>

                                <h:panelGrid columns="3">
                                    <h:graphicImage  stylestyleClassikont-hgi-com_arrow"   url="/resources/imgs/com_arrow.png"  />

                                    <h:panelGrid stylestyleClassikont-"   >
                                        <h:panelGroup>
                                            <h:outputText  stylestyleClassikont-hot-idstrnombre"   id="idstrnombre" value="#{rowcomentario.jsfUsuario.tercero.strnombrecompleto}" />
                                            <interkont:spacer  />
                                            <h:outputText  stylestyleClassikont-hot-iddate"   id="iddate" value="#{rowcomentario.datefechaopinion}" >
                                                <f:convertDateTime timeZone="GMT-5" type="both" dateStyle="long"/>
                                            </h:outputText>
                                        </h:panelGroup>
                                        <h:panelGrid >
                                            <h:outputLabel  stylestyleClassikont-hot-idcomentario"    id="idcomentario" value="#{rowcomentario.stropinion}"
                                                             />
                                        </h:panelGrid>
                                    </h:panelGrid>
                                </h:panelGrid>
                            </h:panelGrid>
                        </a4j:repeat>
                    </h:panelGrid>
                </h:panelGrid>
            </rich:panel>
        </h:form>
    </f:subview>
</ui:composition>
