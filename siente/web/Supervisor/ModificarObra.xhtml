<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition  
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a4j="http://richfaces.org/a4j" xmlns:interkont="http://www.interkont.com/jsf"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions"
    xmlns:m="http://code.google.com/p/gmaps4jsf/"  
    template="/facelets/template_main.xhtml">

    <ui:define name="head">
        <title>Cobra - Supervisor</title>
        <h:outputScript name="script_supervisor.js"/>
    </ui:define>
    <ui:define name="menu">
        <ui:include src="/facelets/menu_gestion.xhtml"/>
    </ui:define>
    <ui:define name="menu_lateral">
        <ui:include src="/facelets/menu_lateral_gestion.xhtml"/>
        <ui:include src="/facelets/menu_lateral_administrar.xhtml"/>
    </ui:define>
    <ui:define name="body">
        <h:form>
            <h:panelGrid id="panel_modificarobra"  rendered="#{Supervisor$AdministrarObraNew.verModificar or Supervisor$AdministrarObraNew.obra.tipoestadobra.intestadoobra==3}">
                <h:panelGroup  rendered="#{!Supervisor$AdministrarObraNew.verSuspender and !Supervisor$AdministrarObraNew.verReiniciar}">
                    <h:outputText  styleClass="ikont- "   rendered="#{Supervisor$AdministrarObraNew.obra.tipoestadobra.intestadoobra!=1 and Supervisor$AdministrarObraNew.obra.tipoestadobra.intestadoobra!=3}" value="#{var.solosepuedemodificar}" styleClass="ikont-"   />
                    <interkont:spacer width="20"/>
                    <a4j:commandButton id="bt_VolverModif" action="#{Supervisor$AdministrarObraNew.mostrarMenuModificar}"
                                       rendered="#{Supervisor$AdministrarObraNew.obra.tipoestadobra.intestadoobra!=3}" render="layoutModificar" value="#{var.volver}"
                                       styleClass="ikont-"      execute="@this">
                    </a4j:commandButton>
                    <interkont:spacer  height="12"/>
                    <h:panelGroup rendered="#{Supervisor$AdministrarObraNew.obra.tipoestadobra.intestadoobra==1 || Supervisor$AdministrarObraNew.obra.tipoestadobra.intestadoobra==3}">
                        <h:panelGroup>
                            <center>
                                <interkont:spacer height="10px" />
                                <h:outputText  styleClass="ikont- "   styleClass="ikont-"   value="#{var.amigosupervisorantesdereemplazar}" />
                                <interkont:spacer height="15px" />
                                <h:outputText  styleClass="ikont- "    value="#{var.ingreselafechadeesta} "/>
                                <rich:calendar locale="#{var.rcalendarlocale}" datePattern="yyyy-MM-dd" direction="topRight" id="date_fechaModificacion" inputSize="10" value="#{Supervisor$ModificarObra.historicoobra.datefecobrahist}"
                                               disabled="#{Supervisor$ModificarObra.tipificacionValida}"/>
                                <interkont:spacer height="10px" />
                                <h:panelGrid >
                                    <rich:panel header="#{var.ingresartiposdemodifica}">
                                        <h:panelGrid   columns="2">
                                            <interkont:spacer height="22"/><interkont:spacer height="22"/>
                                            <h:panelGrid>
                                                <h:outputText  styleClass="ikont- "   styleClass="ikont-"   value="1. #{var.sivaahaceruna}"/>
                                                <interkont:spacer height="10"/>
                                                <h:panelGrid columns="2">
                                                    <h:outputText  styleClass="ikont- "   styleClass="ikont-"   value="#{var.ingreselanueva} "/>
                                                    <rich:calendar locale="#{var.rcalendarlocale}" datePattern="yyyy-MM-dd" direction="topRight" id="date_adicionTiempo" inputSize="10" value="#{Supervisor$ModificarObra.historicoobra.datefecfinhist}"
                                                                   disabled="#{Supervisor$ModificarObra.tipificacionValida}">
                                                        <a4j:ajax listener="#{Supervisor$ModificarObra.evaluarVerSoportes}" event="changed" render="panel_botonsoporte" />
                                                    </rich:calendar>
                                                </h:panelGrid>
                                                <interkont:spacer height="10"/>
                                                <h:panelGrid>
                                                    <h:outputText  styleClass="ikont- "   styleClass="ikont-"   value="2. #{var.sihayunaadicion}"/>
                                                    <interkont:spacer height="10"/>
                                                    <h:panelGrid columns="2">
                                                        <h:outputText  styleClass="ikont- "   styleClass="ikont-"   value="#{var.ingresevaloradicion} " />
                                                        <rich:inputNumberSpinner id="txt_adicionPresupuesto" value="#{Supervisor$ModificarObra.valorhistorico}" minValue="0" maxValue="400000000" inputSize="20" disabled="#{Supervisor$ModificarObra.tipificacionValida}">
                                                            <a4j:ajax event="change" render="panel_botonsoporte" listener="#{Supervisor$ModificarObra.evaluarVerSoportes}" />
                                                        </rich:inputNumberSpinner>
                                                    </h:panelGrid>
                                                    <interkont:spacer height="10"/>
                                                </h:panelGrid>

                                            </h:panelGrid>
                                            <h:panelGrid>
                                                <h:outputText  styleClass="ikont- "   styleClass="ikont-"   value="3. #{var.siexisteunconvenio}"/>
                                                <interkont:spacer height="10"/>

                                                <h:outputText  styleClass="ikont- "   styleClass="ikont-"   value="#{var.decidasisetrata}"/>
                                                <interkont:spacer height="10"/>
                                                <h:panelGroup>
                                                    <h:outputText  styleClass="ikont- "   styleClass="ikont-"   value="#{var.cambiosdeprecios}"/>
                                                    <h:selectBooleanCheckbox value="#{Supervisor$ModificarObra.cambioPrecios}" disabled="#{Supervisor$ModificarObra.tipificacionValida}" >
                                                        <a4j:ajax event="change" render="panel_subirActaConvenio, layoutDocActaConvenio"/>
                                                    </h:selectBooleanCheckbox>
                                                    <h:outputText  styleClass="ikont- "   styleClass="ikont-"   value="#{var.modificaciondeactividades}"/>
                                                    <h:selectBooleanCheckbox value="#{Supervisor$ModificarObra.adicionActividades}" disabled="#{Supervisor$ModificarObra.tipificacionValida}">
                                                        <a4j:ajax event="change" render="panel_subirActaConvenio, layoutDocActaConvenio"/>
                                                    </h:selectBooleanCheckbox>
                                                </h:panelGroup>
                                                <h:panelGrid id="panel_subirActaConvenio"  columns="2">
                                                    <a4j:commandButton id="adjuntarActaConvenio" styleClass="ikont-"   value="#{var.adjuntaractadeconvenio}"  rendered="#{Supervisor$ModificarObra.cambioPrecios || Supervisor$ModificarObra.adicionActividades}"
                                                                       onclick="#{rich:component('panelUploadActaConvenio')}.show(); return true;" disabled="#{Supervisor$ModificarObra.tipificacionValida}"/>

                                                    <rich:panel rendered="#{Supervisor$ModificarObra.cambioPrecios || Supervisor$ModificarObra.adicionActividades}">
                                                        <h:outputText  styleClass="ikont- "   rendered="#{Supervisor$ModificarObra.subirActaConvenio.size==0}" value="#{var.nohasubidoningun}"/>
                                                        <center>
                                                            <rich:dataGrid columns="1" rowKeyVar="row" value="#{Supervisor$ModificarObra.subirActaConvenio.files}" var="file" rendered="#{Supervisor$ModificarObra.subirActaConvenio.size!=0}"
                                                                           >
                                                                <h:outputText  styleClass="ikont- "   value=" #{file.onlyName}" />
                                                                <interkont:spacer height="8" width="15"/>
                                                                <h:graphicImage  styleClass="ikont- "    rendered="#{Supervisor$ModificarObra.subirActaConvenio.size!=0}"/>

                                                            </rich:dataGrid>
                                                        </center>
                                                    </rich:panel>

                                                </h:panelGrid>
                                            </h:panelGrid>

                                        </h:panelGrid>
                                    </rich:panel>
                                </h:panelGrid>
                            </center>
                        </h:panelGroup>
                        <center>
                            <h:panelGroup id="panel_botonsoporte">
                                <h:panelGroup id="gpPolizaContrato" rendered="#{Supervisor$ModificarObra.verSoportes}">
                                    <rich:panel>
                                        <f:facet name="header">
                                            <h:outputText  styleClass="ikont- "   value="#{var.ingresardocumento}"/>
                                        </f:facet>
                                        <h:panelGrid id="panel_subirOtroSi"  columns="2" width="80%">
                                            <a4j:commandButton id="adjuntarOtroSi" value="#{var.adjuntarotrosi}" styleClass="ikont-"     
                                                               immediate="true"
                                                               onclick="#{rich:component('panelUploadOtroSi')}.show(); return true;" disabled="#{Supervisor$ModificarObra.tipificacionValida}"/>
                                            <rich:dataGrid columns="1" rowKeyVar="row" value="#{Supervisor$ModificarObra.subirOtroSi.files}" var="file" >
                                                <h:outputText  styleClass="ikont- "   id="txt_nombreArchivoOtroSi" value=" #{file.onlyName}"/>
                                            </rich:dataGrid>
                                        </h:panelGrid>
                                        <h:panelGroup id="tablaPolizas" >
                                            <rich:dataTable id="dtPolizas"  rows="6" 
                                                            rowKeyVar="filaSeleccionada" var="registro"  value="#{Supervisor$ModificarObra.listapolizas}">
                                                <rich:column id="tc-strTipoPoliza" width="100px">
                                                    <f:facet name="header">
                                                        <h:outputText  styleClass="ikont- "   value="#{var.tipoPolizaContrato}" />
                                                    </f:facet>
                                                    <h:outputText  styleClass="ikont- "   id="otxt-strTipoPoliza" value="#{registro.tipopoliza.strdesctipopoliza}"/>
                                                </rich:column>
                                                <rich:column id="tc-strnumPolizaContrato" width="100px">
                                                    <f:facet name="header">
                                                        <h:outputText  styleClass="ikont- "   value="#{var.numPolizaContrato}" />
                                                    </f:facet>
                                                    <h:outputText  styleClass="ikont- "   id="otxt-strnumPolizaContrato" value="#{registro.strnumpoliza}"/>
                                                </rich:column>
                                                <rich:column id="tc-strVencimientoPoliza" width="100px">
                                                    <f:facet name="header">
                                                        <h:outputText  styleClass="ikont- "   value="#{var.vencimientoPoliza}" />
                                                    </f:facet>
                                                    <h:outputText  styleClass="ikont- "   id="otxt-strVencimientoPoliza" value="#{registro.datefechavecimiento}">
                                                        <f:convertDateTime pattern="yyyy-MM-dd"/>
                                                    </h:outputText>
                                                </rich:column>
                                                <rich:column id="tc-strEntidadPoliza" width="100px">
                                                    <f:facet name="header">
                                                        <h:outputText  styleClass="ikont- "   value="#{var.entidadPoliza}" />
                                                    </f:facet>
                                                    <h:outputText  styleClass="ikont- "   id="otxt-strEntidadPoliza" value="#{registro.entidad.strnombreentidad}"/>
                                                </rich:column>
                                                <rich:column id="tc-streliminarPoliza" width="250px">
                                                    <f:facet name="header"/>
                                                    <a4j:commandButton value="#{var.editar}" action="#{Supervisor$ModificarObra.elegirPolizaEditar(filaSeleccionada)}" immediate="true" disabled="#{Supervisor$ModificarObra.tipificacionValida}"
                                                                       oncomplete="#{rich:component('panelPolizaContrato')}.show(); return true;"   render="gpPolizaContratoModal"/>
                                                </rich:column>
                                                <f:facet name="footer">
                                                    <rich:dataScroller id="dspolizas" for="dtPolizas"/>
                                                </f:facet>
                                            </rich:dataTable>
                                        </h:panelGroup>

                                    </rich:panel>
                                </h:panelGroup>


                            </h:panelGroup>
                        </center>
                        <interkont:spacer height="10" />
                        <h:panelGroup id="panel_justifiqueModificacion">
                            <h:panelGrid   >
                                <rich:panel header="#{var.porfavorjustifique}" >
                                    <h:panelGroup >
                                        <center>

                                            <interkont:spacer height="20" />
                                            <h:inputTextarea cols="80" rows="4" value="#{Supervisor$ModificarObra.historicoobra.strrazonmodif}" disabled="#{Supervisor$ModificarObra.tipificacionValida}"/>
                                        </center>
                                    </h:panelGroup>
                                </rich:panel>
                            </h:panelGrid>
                        </h:panelGroup>
                        <h:panelGroup  id="panel_subirCronograma">
                            <center>
                                <h:panelGrid columns="3">
                                    <h:panelGrid>
                                        <a4j:commandButton id="generarcronograma"  render="layoutCronMod"
                                                           value="#{var.generarcronograma}" action="#{Supervisor$ModificarObra.generarCronograma}"
                                                           styleClass="ikont-"     
                                                           rendered="#{Supervisor$ModificarObra.tipificacionValida}">
                                            <a4j:ajax event="complete"  onbeforesubmit="#{rich:component('mp_cronogramaMod')}.show(); return true;" render="layoutCronMod"/>
                                        </a4j:commandButton>
                                        <a4j:commandButton id="boton_tipificar_modificacion" action="#{Supervisor$ModificarObra.registrarTipificacion}" value="#{var.tipificarmodificacion}"
                                                           rendered="#{!Supervisor$ModificarObra.tipificacionValida}" render="layoutAdministrar"
                                                           styleClass="ikont-"     >
                                            <a4j:ajax event="oncomplete"  onbeforesubmit="#{rich:component('panelConfirmarTipificacion')}.show(); return true;" render="layoutAdministrar"/>
                                        </a4j:commandButton>

                                        <a4j:commandButton id="btn_subir_diligenciado" value="#{var.subirarchivodiligenciado}" styleClass="ikont-"     
                                                           rendered="#{Supervisor$ModificarObra.tipificacionValida}" onclick="#{rich:component('panelUploadCronograma')}.show(); return false;" render="layoutDocCronog"/>
                                    </h:panelGrid>
                                    <rich:panel rendered="#{Supervisor$ModificarObra.tipificacionValida}">

                                        <h:outputText  styleClass="ikont- "   rendered="#{Supervisor$ModificarObra.subirCronograma.size==0}" value="#{var.nohasubidoningun}"/>
                                        <center>
                                            <rich:dataGrid columns="1" rowKeyVar="row" value="#{Supervisor$ModificarObra.subirCronograma.files}" var="file" rendered="#{Supervisor$ModificarObra.subirCronograma.size!=0}"
                                                           >
                                                <h:outputText  styleClass="ikont- "   value=" #{file.onlyName}" />
                                                <interkont:spacer height="8" width="15"/>
                                                <h:graphicImage  styleClass="ikont- "   rendered="#{Supervisor$ModificarObra.cronovalido}"/>
                                                <h:graphicImage  styleClass="ikont- "   rendered="#{!Supervisor$ModificarObra.cronovalido}"/>
                                                <h:outputText  styleClass="ikont- "   value="#{Supervisor$ModificarObra.mensajeModificacion}" styleClass="ikont-"  />
                                            </rich:dataGrid>
                                        </center>
                                    </rich:panel>

                                    <h:panelGroup id="layoutRegTip">
                                        <a4j:commandButton id="btn_cancelar_tipificacion" value="#{var.cancelar}"    
                                                           action="#{Supervisor$ModificarObra.borrarUltimaTipificacion}" render="layoutModificar, layoutDocOtroSi"
                                                           rendered="#{Supervisor$ModificarObra.tipificacionValida}" >
                                            <a4j:ajax event="complete" render="layoutModificar, layoutDocOtroSi"  />
                                        </a4j:commandButton>

                                        <a4j:commandButton id="btn_registrar_modificacion" value="#{var.registrarmodificacion}" styleClass="ikont-"     
                                                           action="#{Supervisor$ModificarObra.registrarModificacion}" render="layoutConfMod"
                                                           rendered="#{Supervisor$ModificarObra.tipificacionValida and Supervisor$ModificarObra.cronovalido}" >
                                            <a4j:ajax event="complete" render="layoutPrincipal, layoutModificar, layoutMatrix, layoutConfMod" onbeforesubmit="#{rich:component('panelConfirmarModificacion')}.show();return true;"/>
                                        </a4j:commandButton>
                                    </h:panelGroup>
                                </h:panelGrid>
                            </center>
                        </h:panelGroup>
                    </h:panelGroup>
                </h:panelGroup>
            </h:panelGrid>

        </h:form>

        <ui:include src="/modal/panelConfirmarModificacion.xhtml"/>
        <ui:include src="/modal/panelConfirmarTipificacion.xhtml"/>
        <ui:include src="/modal/panelUploadOtroSiModal.xhtml"/>
        <ui:include src="/modal/panelUploadActaConvenioModal.xhtml"/>
        <ui:include src="/modal/panelUploadCronogramaModal.xhtml"/>
        <ui:include src="/modal/panelUploadActaSuspensionModal.xhtml"/>
        <ui:include src="/modal/panelUploadActaReinicioModal.xhtml"/>
        <ui:include src="/modal/polizaContratoModal.xhtml"/>

    </ui:define>

</ui:composition>
