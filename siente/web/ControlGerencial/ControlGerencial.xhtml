<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:composite="http://java.sun.com/jsf/composite"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:a4j="http://richfaces.org/a4j"
                xmlns:rich="http://richfaces.org/rich"
                template="/facelets/template_main.xhtml"
                xmlns:interkont="http://www.interkont.com/jsf">
    <ui:define name="head">
        <h:outputScript library="amcharts" name="amcharts.js"></h:outputScript>

        <link href="/#{var.versioncobra}/resources/gSlider/style/image-slider.css" rel="stylesheet" type="text/css" />
        <link href="/#{var.versioncobra}/resources/css/tablerocontrol.css" rel="stylesheet" type="text/css" />
        <script src="/#{var.versioncobra}/resources/gSlider/js/panel-image-slider.js" type="text/javascript"></script>
        <link href="/#{var.versioncobra}/resources/gSlider/style/panel-image-slider.css" rel="stylesheet" type="text/css" />


        <h:outputScript  name="RGraph.meter.js" library="js/RGraph" />
        <h:outputScript  name="RGraph.common.core.js" library="js/RGraph" />
        <h:outputScript name="RGraph.common.effects.js" library="js/RGraph" />
        <h:outputScript name="RGraph.common.context.js" library="js/RGraph" />
        <h:outputScript name="RGraph.common.annotate.js" library="js/RGraph" />
        <h:outputScript name="RGraph.common.tooltips.js" library="js/RGraph" />
        <h:outputScript name="RGraph.common.zoom.js" library="js/RGraph" />
        <h:outputScript name="RGraph.common.resizing.js" library="js/RGraph"/>
    </ui:define>
    <ui:define name="menu">
        <ui:include src="/facelets/menu_gestion.xhtml"/>
    </ui:define>
    <ui:define name="title">
        <h:outputText  class="id-jsf- "   value="#{var.tablerodecontrol}"/>
    </ui:define>
    <ui:define name="menu_lateral">
        <ui:include src="/facelets/menu_lateral_gestion.xhtml"/>                
        <ui:include src="/facelets/menu_lateral_novedades.xhtml"/>
        <h:panelGroup rendered="#{SessionBeanCobra.usuarioObra.renderrecurso.btnslider_dashboard}" id="gpSliderpanelesdash2">
            <ui:include src="/Ciudadano/Slider_paneles_dashboard.xhtml"/>
        </h:panelGroup>

    </ui:define>
    <ui:define name="body">
        <h:form id="dashboard">
            <h:panelGrid columns="1" id="panelgerencial" cellpadding="0" cellspacing="0" width="90%">
                <h:outputText  class="id-jsf- "   value="#{var.texto1_inversion_tablerocontrol}" class="id-jsf-"  />
                <h:panelGrid id="panelcombos" class="id-jsf-"   columns="5"  >
                    <h:panelGroup class="id-jsf-"  >
                        <h:selectOneMenu value="#{ControlGerencial.vistaicom}" class="id-jsf-"  >
                            <f:selectItem itemLabel="#{var.zonaespec}" itemValue="1"/>
                            <f:selectItem itemLabel="#{var.localidad}" itemValue="0"/>
                            <a4j:ajax event="change" render="panelcombos" />
                        </h:selectOneMenu>
                    </h:panelGroup>
                    <h:panelGroup class="id-jsf-"   rendered="#{ControlGerencial.vistaicom != 1}">
                        <h:selectOneMenu value="#{ControlGerencial.deptos}" class="id-jsf-"  >
                            <f:selectItem itemValue="0" itemLabel="Todos"/>
                            <f:selectItems value="#{ControlGerencial.sedeptos}" />
                            <a4j:ajax event="change" listener="#{ControlGerencial.llenarMunici}" render="municipioincom"/>
                        </h:selectOneMenu>
                    </h:panelGroup>
                    <h:panelGroup id="municipioincom" class="id-jsf-"   rendered="#{ControlGerencial.vistaicom != 1}">
                        <h:selectOneMenu value="#{ControlGerencial.muni}" class="id-jsf-"  >
                            <f:selectItem itemValue="0" itemLabel="Todos"/>
                            <f:selectItems value="#{ControlGerencial.semuni}" />
                        </h:selectOneMenu>
                    </h:panelGroup>
                    <h:panelGroup class="id-jsf-"   rendered="#{ControlGerencial.vistaicom == 1}">
                        <h:selectOneMenu value="#{ControlGerencial.intzona}" class="id-jsf-"  >
                            <f:selectItem itemValue="0" itemLabel="Todos"/>
                            <f:selectItems value="#{ControlGerencial.zonaespecifica}"/>
                        </h:selectOneMenu>
                    </h:panelGroup>
                    <h:panelGroup >
                        <h:commandLink value="Graficar" action="#{ControlGerencial.generarGraficos}" class="id-jsf-"   />
                    </h:panelGroup>
                </h:panelGrid>
                <rich:panel bodyClass="panelTableroControl panelSlider" headerClass="topheader" >
                    <f:facet name="header">
                        <h:outputText  class="id-jsf- "   value="Los últimos 10 proyectos reportados"/>
                    </f:facet>

                    <div id="container">
                        <div id="slider" class="divSlider">
                            <a4j:repeat value="#{ControlGerencial.listaimagenesslider}" var="imagen">
                                <div>
                                    <h:graphicImage alt="#{imagen.obra.strnombrecrot}" url="#{var.ipserver}siente#{imagen.strubicacion}" />
                                    <h:outputLink
                                        value="#{facesContext.externalContext.requestContextPath}/faces/Supervisor/DetalleObra.xhtml?id=#{imagen.obra.intcodigoobra}" >
                                        <h:outputText  class="id-jsf- "   value="#{imagen.obra.strnombrecrot}"/>
                                    </h:outputLink>
                                </div>
                            </a4j:repeat>
                        </div>
                    </div>
                </rich:panel>
                <h:panelGrid columns="2" cellpadding="0" cellspacing="0" columnClasses="seccion-izq-dashboard,seccion-der-dashboard">
                    <h:panelGrid cellpadding="0" cellspacing="0" width="90%">
                        <rich:panel headerClass="topheader" bodyClass="panelTableroControl panelValorInversion">
                            <f:facet name="header">
                                <h:outputText  class="id-jsf- "   value="#{(ControlGerencial.invporregion)?'Inversión Total por Región':'Inversión Total Nacional'}"/>
                            </f:facet>
                            <center>
                                <h:panelGrid   columns="2" class="id-jsf-"   rendered="#{!ControlGerencial.invporregion}">
                                    <h:graphicImage url="/resources/imgs/dash_01.png" width="50" height="50" />
                                    <h:panelGroup >
                                        <h:outputText  class="id-jsf- "   value="#{ControlGerencial.informaciondash.inversionTotalNal}">
                                            <f:convertNumber pattern="$###,###"/>
                                        </h:outputText>
                                    </h:panelGroup>
                                </h:panelGrid>

                                <h:panelGrid   columns="2" class="id-jsf-"   rendered="#{ControlGerencial.invporregion}">
                                    <h:graphicImage url="/resources/imgs/dash_01.png" width="50" height="50" />
                                    <h:panelGroup >
                                        <h:outputText  class="id-jsf- "   value="#{ControlGerencial.informaciondash.inversionTotalRegion}">
                                            <f:convertNumber pattern="$###,###"/>
                                        </h:outputText>
                                    </h:panelGroup>
                                </h:panelGrid>
                            </center>
                            <interkont:spacer height="10"/>
                            <h:panelGrid columns="3" columnClasses="panelderecha"  rendered="false">
                                <interkont:spacer width="30"/>
                                <h:panelGrid columnClasses="panelderecha" >
                                    <h:outputLabel  class="id-jsf- "   value="#{var.carteracolectiva}" />
                                    <h:outputText  class="id-jsf- "   value="#{ControlGerencial.porcentajeCartera}%" />
                                    <h:outputLabel  class="id-jsf- "   value="#{ControlGerencial.totalCartera}" >
                                        <f:convertNumber pattern="$###,###"/>
                                    </h:outputLabel>
                                </h:panelGrid>

                                <h:outputText  class="id-jsf- "   value="#{ControlGerencial.columnatotalgeneral.scriptcolumnaporcentual}" escape="false"/>
                            </h:panelGrid>
                            <interkont:spacer height="30"/>
                            <h:panelGrid columns="3" columnClasses="panelderecha"  rendered="false">
                                <interkont:spacer width="30"/>
                                <h:panelGrid columnClasses="panelderecha" >
                                    <h:outputLabel  class="id-jsf- "   value="#{var.pago} a contratistas" />
                                    <h:outputText  class="id-jsf- "   value="#{ControlGerencial.porcentajePago}%" />
                                    <h:outputLabel  class="id-jsf- "   value="#{ControlGerencial.totalPago}" >
                                        <f:convertNumber pattern="$###,###"/>
                                    </h:outputLabel>
                                </h:panelGrid>
                                <h:outputText  class="id-jsf- "   value="#{ControlGerencial.columnapagocontratistas.scriptcolumnaporcentual}" escape="false"/>
                            </h:panelGrid>
                            <interkont:spacer height="30"/>
                            <h:panelGrid columns="3" columnClasses="panelderecha"  rendered="false">
                                <interkont:spacer width="30"/>
                                <h:panelGrid columnClasses="panelderecha" >
                                    <h:outputLabel  class="id-jsf- "   value="#{var.legalizacion}" />
                                    <h:outputText  class="id-jsf- "   value="#{ControlGerencial.porcentajeLegalizado}%"  />
                                    <h:outputText  class="id-jsf- "   value="#{ControlGerencial.totalLegalizado}" >
                                        <f:convertNumber pattern="$###,###"/>
                                    </h:outputText>
                                </h:panelGrid>
                                <h:outputText  class="id-jsf- "   value="#{ControlGerencial.columnalegalizacion.scriptcolumnaporcentual}" escape="false"/>
                            </h:panelGrid>
                            <interkont:spacer height="20"/>
                            <interkont:spacer height="40"/>
                        </rich:panel>
                    </h:panelGrid>
                    <h:panelGrid columns="2" cellpadding="0" cellspacing="0">
                        <rich:panel headerClass="topheader" bodyClass="panelTableroControl panelPersonasHogares">
                            <f:facet name="header">
                                <h:outputText  class="id-jsf- "   value="Personas y hogares"/>
                            </f:facet>
                            <h:panelGrid>
                                <h:panelGroup>
                                    <h:panelGrid columns="2" cellpadding="0" captionStyle="0" class="id-jsf-"  >
                                        <h:graphicImage value="/resources/imgs/dash_07.png" class="id-jsf-"  />
                                        <h:outputText  class="id-jsf- "   value="Personas" class="id-jsf-"  />
                                    </h:panelGrid>
                                    <h:outputText  class="id-jsf- "   value="#{ControlGerencial.barraspersonas.scriptGrafico}" escape="false"/>
                                    <div id="chartpersonas" ></div>
                                </h:panelGroup>
                                <h:panelGroup >
                                    <h:panelGrid columns="2" cellpadding="0" captionStyle="0" class="id-jsf-"  >
                                        <h:graphicImage value="/resources/imgs/dash_06.png" class="id-jsf-"  />
                                        <h:outputText  class="id-jsf- "   value="Hogares" class="id-jsf-"  />
                                    </h:panelGrid>
                                    <h:outputText  class="id-jsf- "   value="#{ControlGerencial.barrashogares.scriptGrafico}" escape="false"/>
                                    <div id="charthogares" ></div>
                                </h:panelGroup>
                            </h:panelGrid>
                        </rich:panel>
                        <rich:panel headerClass="topheader" bodyClass="panelTableroControl panelConvenios">
                            <f:facet name="header">
                                <h:outputText  class="id-jsf- "   value="Entidades Nacionales"/>
                            </f:facet>
                            <h:panelGroup>
                                <h:outputText  class="id-jsf- "   value="#{ControlGerencial.informaciondash.inversionConvenios}" class="id-jsf-"  >
                                    <f:convertNumber pattern="$###,###"/>
                                </h:outputText>
                                <h:inputHidden id="estaen" value="#{ControlGerencial.informaciondash.intPorcentageEje}" />


                                <div id="popUpDiv">
                                    <div id="capaContent">
                                        <div>
                                            <canvas id="meterds" width="270" height="137">
                                                <div class="canvasfallback">[No canvas support]</div></canvas>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <h:outputText  class="id-jsf- "   class="id-jsf-"  
                                                  
                                                  value="Porcentaje de Inversión: " />
                                    <h:outputText  class="id-jsf- "   id="stEstado" class="id-jsf-"  
                                                  value="#{ControlGerencial.informaciondash.porInversionConvenios}"><!--llamar metodo-->
                                        <f:convertNumber type="percent"/>
                                    </h:outputText>
                                </div>
                            </h:panelGroup>
                            <interkont:spacer height="40" />
                            <h:panelGroup>
                                <a4j:commandLink rendered="#{var.vermasdashboard}" 
                                                 value="#{var.ver}+"
                                                 class="id-jsf-"    
                                                 action="#{ControlGerencial.obtenerConsolidadoConvenios}"
                                                 execute="@this"
                                                 render=":modalDashboard_entesnacionales"
                                                 oncomplete="#{rich:component('modalDashboard_entesnacionales')}.show();">

                                </a4j:commandLink>
                            </h:panelGroup>
                        </rich:panel>

                        <rich:panel  headerClass="topheader" bodyClass="panelTableroControl panelRehabilitacion">
                            <f:facet name="header">
                                <h:outputText  class="id-jsf- "   value="Entes Territoriales"/>
                            </f:facet>
                            <h:panelGrid  rowClasses="cell-top">
                                <h:panelGroup>
                                    <center>
                                        <h:panelGrid columnClasses="panelcenter">
                                            <h:outputLabel  class="id-jsf- "   value="#{var.dashinvtipoproyecto}" />
                                            <h:outputText  class="id-jsf- "   value="#{ControlGerencial.piecontrol.scriptPieDashboard}" escape="false"/>
                                            <div id="proyectospie" ></div>
                                        </h:panelGrid>
                                        <h:outputText  class="id-jsf- "   value="#{ControlGerencial.informaciondash.inversionObra}" class="id-jsf-"  >
                                            <f:convertNumber pattern="$###,###"/>
                                        </h:outputText>
                                        <h:panelGrid columnClasses="panelcenter"  rendered="false">
                                            <h:outputLabel  class="id-jsf- "   value="#{var.ejecuciontotal}" />
                                            <h:outputText  class="id-jsf- "   value="#{ControlGerencial.columnaproyectoconsolidado.scriptcolumnaporcentual}" escape="false"/>
                                        </h:panelGrid>
                                    </center>
                                </h:panelGroup>
                                <interkont:spacer height="10" />
                                <a4j:commandLink rendered="#{var.vermasdashboard}" 
                                                 value="#{var.ver}+"
                                                 class="id-jsf-"    
                                                 action="#{ControlGerencial.obtenerConsolidadoRehabilitacion}"
                                                 execute="@this"
                                                 render=":modalDashboard_rehabilitacion"
                                                 oncomplete="#{rich:component('modalDashboard_rehabilitacion')}.show();">

                                </a4j:commandLink>
                            </h:panelGrid>
                        </rich:panel>
                        <rich:panel  headerClass="topheader" bodyClass="panelTableroControl panelAtencion">
                            <f:facet name="header">
                                <h:outputText  class="id-jsf- "   value="Atención humanitaria"/>
                            </f:facet>

                            <h:panelGroup>
                                <ul >
                                    <interkont:spacer height="50"/>
                                    <a4j:repeat value="#{ControlGerencial.listaServiciosAHAtendidas}" var="item">

                                        <li class="liItemAtencion">
                                            <h:outputText  class="id-jsf- "   value="#{item.etiqueta}:" class="id-jsf-"   />

                                            <h:outputText  class="id-jsf- "   value="#{item.valormoney}" class="id-jsf-"  >
                                                <f:convertNumber pattern="###,###"/>
                                            </h:outputText>

                                        </li>

                                    </a4j:repeat>

                                </ul>

                            </h:panelGroup>
                            <h:panelGrid>
                                <interkont:spacer height="20" />
                                <h:outputText  class="id-jsf- "   value="#{ControlGerencial.informaciondash.inversionAh}" class="id-jsf-"  >
                                    <f:convertNumber pattern="$###,###"/>
                                </h:outputText>
                                <interkont:spacer height="5" />                                        
                                <h:panelGroup>
                                    <a4j:commandLink rendered="#{var.vermasdashboard}" 
                                                     value="#{var.ver}+"
                                                     class="id-jsf-"    
                                                     action="#{ControlGerencial.obtenerConsolidadoAh}"
                                                     execute="@this"
                                                     render=":modalDashboard_ah"
                                                     oncomplete="#{rich:component('modalDashboard_ah')}.show();">  
                                    </a4j:commandLink>
                                </h:panelGroup>
                            </h:panelGrid>
                        </rich:panel>
                    </h:panelGrid>
                </h:panelGrid>
            </h:panelGrid>
        </h:form>
        <ui:include src="/ControlGerencial/modalDashboard/modalDashboardRehabilitacion.xhtml"/>
        <ui:include src="/ControlGerencial/modalDashboard/modalDashboardConvenios.xhtml"/>
        <ui:include src="/ControlGerencial/modalDashboard/modalDashboardAtencionH.xhtml"/>
        <script src="/#{var.versioncobra}/resources/gSlider/js/jquery-1.4.4.min.js" type="text/javascript"></script>
        <script src="/#{var.versioncobra}/resources/gSlider/js/image-slider.js" type="text/javascript"></script>
        <script src="/#{var.versioncobra}/resources/gSlider/js/panel-image-slider.js" type="text/javascript"></script>
        <script type="text/javascript">
            var $j = jQuery.noConflict();
            $j(document).ready(function() {
                var $i = jQuery.noConflict();
                $i('#slider').slider({speed: 500});
                $i('#slider2').slider2({speed: 500, action: true});
            });
        </script>
        <script>
            function init() {
                var estaen = document.getElementById("dashboard:estaen").value;
                var min = 0;
                var max = 100;

                var meterds = new RGraph.Meter('meterds', min, max, estaen);

                var grad1 = meterds.context.createRadialGradient(meterds.canvas.width / 2, meterds.canvas.height - 25, 0, meterds.canvas.width / 2, meterds.canvas.height - 25, 200);
                grad1.addColorStop(0, 'green');
                grad1.addColorStop(1, 'white');

                var grad2 = meterds.context.createRadialGradient(meterds.canvas.width / 2, meterds.canvas.height - 25, 0, meterds.canvas.width / 2, meterds.canvas.height - 25, 200);
                grad2.addColorStop(0, 'yellow');
                grad2.addColorStop(1, 'white');

                var grad3 = meterds.context.createRadialGradient(meterds.canvas.width / 2, meterds.canvas.height - 25, 0, meterds.canvas.width / 2, meterds.canvas.height - 25, 200);
                grad3.addColorStop(0, 'red');
                grad3.addColorStop(1, 'white');

                meterds.Set('chart.labels.position', 'inside');
                meterds.Set('chart.title.vpos', 0.5);
                meterds.Set('chart.title.color', 'black');
                meterds.Set('chart.green.color', grad1);
                meterds.Set('chart.yellow.color', grad2);
                meterds.Set('chart.red.color', grad3);
                meterds.Set('chart.background.color', 'white');
                meterds.Set('chart.background.color', 'red');
                meterds.Set('chart.border', false);
                meterds.Set('chart.needle.linewidth', 5);
                meterds.Set('chart.needle.tail', true);
                meterds.Set('chart.tickmarks.big.num', 0);
                meterds.Set('chart.tickmarks.small.num', 0);
                meterds.Set('chart.segment.radius.start', 90);
                meterds.Set('chart.needle.radius', 50);
                meterds.Set('chart.needle.linewidth', 2);
                meterds.Set('chart.linewidth.segments', 9);
                meterds.Set('chart.strokestyle', 'white');
                meterds.Set('chart.text.size', 7);
                RGraph.Effects.Meter.Grow(meterds);
            }
            window.onload = init;
        </script>

    </ui:define>


</ui:composition>